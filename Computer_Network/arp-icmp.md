---
title: 'arp,icmp'
tags: 计算机网络
abbrlink: 816ed8ac
date: 2020-06-23 11:21:36
---

## ARP 地址解析协议（Address Resolution Protocol）
无论网络层使用什么协议，在实际的数据链路层传输数据帧的时候都是要使用硬件地址，也即MAC地址，所以需要一种方法来实现ip->mac地址的映射，这就是ARP协议干的事情，所以ARP协议工作在网络层	。 每台主机都设有一个ARP高速缓存，用来存放局域网上各主机和路由器的ip地址到MAC地址的映射表，称ARP表。<br>
ARP工作原理： 主机A想要向本局域网内的主机B通信，发送ip数据报时，先查看其ARP高速缓存表中有无对应的B的ip地址，如存在B的ip地址，就可查出其对应的mac地址，再将硬件地址写入MAC帧中，然后通过局域网发给主机B。如果没有就使用目的MAC为FF:FF:FF:FF:FF的帧来封装并广播ARP请求分组，使局域网的所有主机收到ARP请求。主机B收到ARP请求后，发现对应的是它自己的ip，就将自己的硬件地址回发，称为ARP响应分组，主机A收到分组后就将此映射写入自己的ARP缓存表中。
 <!-- more -->
#### ARP的四种典型情况
1. 发送方是主机，要把ip数据报发往本局域网另一部主机，这时用arp表找到目的主机的mac地址。
2. 发送方是主机，要把ip数据报发往另一个网络的一台主机，此时用ARP找到本网段的路由器的硬件地址，剩下的工作由路由器解决。
3. 发送方是路由器，要把ip数据报发送给本网段的一台主机，直接用arp表找到目的主机的mac地址。
4. 发送方是路由器，要把ip数据报发往另一个网络的一台主机，这时用arp找到本网络上的一个路由器的mac地址，剩下的工作由找到的路由器解决。

## ICMP （Internet Control Message Protocol）网际控制报文协议
工作在网络层，为了提高ip数据报的交付成功的机会，在网络层使用icmp协议让主机或者路由器报告差错和异常情况。ICMP报文作为ip数据报的数据，加上数据报的首部组成ip数据报发送出去。<br>
ICMP 的报文种类有两种，ICMP差错报告报文和ICMP询问报文<br>
（1）终点不可达 路由器或主机无法交付数据时，就向源点发送重点不可达报文。
（2）源点抑制 当网络中出现拥塞而丢弃数据报时，就向源点发送抑制报文。让源点降低速率。<br>
（3）时间超过 TTL减为0时，丢弃数据报 ，向源点发送时间超过报文<br>
（4） 参数问题 当目的主机或路由器收到首部字段 不正确时，就丢弃该数据报然后发送参数问题报文。<br>
（5）改变路由 （重定向） 有更好的路由路径<br>
不应该发送ICMP差错报告报文的情况
（1） 对ICMP的差错报文 不再发送ICMP的差错报文
（2） 对第一个分片的数据的后续数据报片都不发送ICMP差错报文
（3） 对具有组播地址的数据报都不发送ICMP差错报文
（4） 具有特殊地址 127.0.0.0 或者0.0.0.0 不发送
ICMP的常见应用有PING 连通性测试，traceroute 路由追踪 其中ping利用了ICMP的回送请求和回答报文，traceroute利用了ICMP超时报文。